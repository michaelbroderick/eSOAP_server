<%- include('./partials/min_dataset_head') %>
    <%- include('./partials/nav_bar') %>

        <div id="form-body" class="container border rounded my-3">

            <h2 class="display-5 text-center my-3">Emergency General Surgery Registry</h2>

            <ul class="nav nav-tabs" id="tabs">
                <li class="nav-item">
                    <a class="nav-link forms-links active" id='demographics_link'>Demographics</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link forms-links" id='emergency_dep_link'>Emergency
                        Department</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link forms-links" id='ed_observations_link'>ED
                        Observations</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link forms-links" id='comorbidities_link'>Comorbidities</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link forms-links input_visibility" id='risk_strat_link'>Risk Stratification</a>
                </li>


                <li class="nav-item">
                    <a class="nav-link forms-links" id='bloods_link'>Bloods &#38;
                        Labs</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link forms-links input_visibility" id='clinical_exam_link'>Clinical
                        Examination</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link forms-links" id='imaging_link'>Imaging</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link forms-links input_visibility" id='sbo_module_link'>SBO Module</a>
                </li>


                <li class="nav-item">
                    <a class="nav-link forms-links" id='disposition_link'>Disposition</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link forms-links input_visibility" id='lap_module_link'>Laparotomy Module</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link forms-links input_visibility" id='procedure_link'>Procedure</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link forms-links" id='surgery_link'>Surgery</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link forms-links input_visibility" id='post_op_risk_link'>Post-op Risk
                        Stratification</a>
                </li>


                <li class="nav-item">
                    <a class="nav-link forms-links" id='post_op_link'>Post Operative</a>
                </li>

            </ul>

            <form action="/modules/<%=req.params.id%>" method="POST" class='validated-form'>


                <span id="hiddenspan" hidden="true">
                    <%=jsonData%>
                </span>



                <section id='demographics_form'>
                    <%- include('./partials/components/demographics') %>
                </section>
                <section id='emergency_dep_form' class='input_visibility'>
                    <%- include('./partials/components/emergency_dep') %>
                </section>

                <section id='ed_observations_form' class='input_visibility'>
                    <%- include('./partials/components/ed_observations') %>
                </section>

                <section id='comorbidities_form' class='input_visibility'>
                    <%- include('./partials/components/comorbidities') %>
                </section>


                <section id='risk_strat_form' class='input_visibility'>
                    <%- include('./partials/components/risk_stratification') %>
                </section>

                <section id='bloods_form' class='input_visibility'>
                    <%- include('./partials/components/bloods') %>
                </section>

                <section id='clinical_exam_form' class='input_visibility'>
                    <%- include('./partials/components/clinical_exam') %>
                </section>

                <section id='imaging_form' class='input_visibility'>

                    <%- include('./partials/components/imaging') %>

                </section>

                <section id='sbo_module_form' class='input_visibility'>

                    <%- include('./partials/components/sbo_module') %>

                </section>

                <section id='disposition_form' class='input_visibility'>
                    <%- include('./partials/components/disposition') %>

                </section>

                <section id='lap_module_form' class='input_visibility'>
                    <%- include('./partials/components/lap_module') %>

                </section>

                <section id='procedure_form' class='input_visibility'>
                    <%- include('./partials/components/procedure') %>

                </section>

                <section id='surgery_form' class='input_visibility'>
                    <%- include('./partials/components/surgery') %>

                </section>


                <section id='post_op_risk_form' class='input_visibility'>
                    <%- include('./partials/components/post_op_risk') %>
                </section>


                <section id='post_op_form' class='input_visibility'>
                    <%- include('./partials/components/post_op') %>

                </section>

                <button type="button" class="btn btn-primary btn-lg my-3 mx-1 next" id="nxt">Next</button>
                <button type="button" class="btn btn-primary btn-lg my-3 mx-1 previous input_visibility"
                    id="prev">Previous</button>
                <button class="btn btn-primary btn-lg my-3 mx-1 view_modules" id="view_mod">Save and Exit</button>

                <input type="number" id="percentComplete" name="percentComplete" hidden=true>

            </form>


        </div>




        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
            integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
            crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
            integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"
            crossorigin="anonymous"></script>
        <script src="/js/form_functions.js"></script>




        <script>
            // populateLocalStorage();
            // populate("input, select, textarea");
            populateFields("input, select, textarea");
            // setListener("input, select, textarea");
            addDateCheck();
            document.querySelector("#pcn_search_bar").hidden = true;

            const moduleNavs = {

                '': ['demographics', 'emergency_dep', 'ed_observations', 'comorbidities', 'bloods', 'imaging', 'disposition', 'surgery', 'post_op'],
                'RIF Pain & Appendicitis': ['demographics', 'emergency_dep', 'ed_observations', 'comorbidities', 'risk_strat', 'bloods', 'clinical_exam', 'imaging', 'disposition', 'procedure', 'surgery', 'post_op'],
                'RUQ & Cholecystitis': ['demographics', 'emergency_dep', 'ed_observations', 'comorbidities', 'risk_strat', 'bloods', 'clinical_exam', 'imaging', 'disposition', 'surgery', 'post_op_risk', 'post_op'],
                'Small Bowel Obstruction': ['demographics', 'emergency_dep', 'ed_observations', 'comorbidities', 'bloods', 'imaging', 'sbo_module', 'disposition', 'surgery', 'post_op'],
                'Laparotomy': ['demographics', 'emergency_dep', 'ed_observations', 'comorbidities', 'bloods', 'imaging', 'sbo_module', 'disposition', 'lap_module', 'procedure', 'surgery', 'post_op']
            };

            setNavListener(['demographics', 'emergency_dep', 'ed_observations', 'comorbidities', 'risk_strat', 'bloods', 'clinical_exam', 'imaging', 'sbo_module', 'disposition', 'lap_module', 'procedure', 'surgery', 'post_op_risk', 'post_op']);
            setNextListener(moduleNavs[document.querySelector('#moduleid').value])
            setPrevListener(moduleNavs[document.querySelector('#moduleid').value])

            document.querySelector('#moduleid').addEventListener('change', () => {
                setNextListener(moduleNavs[document.querySelector('#moduleid').value])
                setPrevListener(moduleNavs[document.querySelector('#moduleid').value])
            })

            // toggleYesNoND("#ercpRadio1", "#ercpRadio2", "#ercpRadio3", "#finding_area")

            toggleSelect('#moduleid', '.rif', ['RIF Pain & Appendicitis'])
            toggleSelect('#moduleid', '.ruq', ['RUQ & Cholecystitis'])
            toggleSelect('#moduleid', '.sbo', ['Small Bowel Obstruction'])
            toggleSelect('#moduleid', '.lap', ['Laparotomy'])
            toggleSelect('#moduleid', '#risk_strat_link', ['RIF Pain & Appendicitis', 'RUQ & Cholecystitis'])
            toggleSelect('#moduleid', '#clinical_exam_link', ['RIF Pain & Appendicitis', 'RUQ & Cholecystitis'])
            toggleSelect('#moduleid', '#sbo_module_link', ['Small Bowel Obstruction'])
            toggleSelect('#moduleid', '#lap_module_link', ['Laparotomy'])
            toggleSelect('#moduleid', '#procedure_link', ['RIF Pain & Appendicitis', 'Laparotomy'])
            toggleSelect('#moduleid', '#post_op_risk_link', ['RUQ & Cholecystitis'])

        </script>
        <script src='/js/frontEndScripts.js'></script>



        <% if(validate==='pass' ){ %>
            <script src='/js/validation.js'></script>
            <% } %>

                </body>

                </html>